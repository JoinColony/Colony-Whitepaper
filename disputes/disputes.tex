\section{Disputes and Arbitration}\label{sec:disputes}
%The what and why of the dispute system: permissive by default, dispute forces votes... FIXME.
Bureaucracies are slow and voting is cumbersome and takes time. Colony aims to be usable, efficient and fluid. The emphasis should be on `getting stuff done' and not about `applying for permission'. For this reason, Colony is designed to be \emph{permissive}. Explicitly, this means that task creation does not need approval (Section \ref{sec:tasks}), neither does the process of getting funding for a task using a regular funding proposal (Section \ref{sec:finance}) nor any number of administrative actions throughout the colony system.\\
The assumption is that well aligned teams tend to be in agreement on most day-to-day goings on in their group. It is expected that members keep an eye out on what their colleagues are doing, but seldom feel the need to intervene. 

The \textbf{Dispute System} is there to resolve disagreements within the group and to punish bad behaviour and fraud. In short, the dispute mechanism allows colony members to signal disapproval and potentially \textbf{force a vote} on decisions and actions that would otherwise have proceeded unimpeded.


\subsubsection*{What are Objections?}
When a member of a colony feels that something is amiss, some task is overpriced, some evaluation incorrect, some funding proposal unjustified; they can \emph{raise an objection}. By doing so, they are fundamentally proposing that a variable, or more than one variable - stored in the \ascode{EternalStorage} contract should be changed to another value. For this reason we call supporters of the objection `the change side' and opponents `the keep side'.

The user raising the objection must also put up a stake to back it up (see Section \ref{sec:costs-of-disputes}). In essence, they are challenging the rest of the colony to disagree with them. In the spirit of avoiding uneccessary voting, the objection will pass automatically \emph{unless} someone else stakes on the counterside and thereby elevates the objection to a \emph{dispute}.

\subsubsection*{What are Disputes?}
We say that a dispute has been raised whenever an objection has found enough support on both the `change' side as well as the `keep' side. Once raised, disputes must be resolved by voting. 

\subsection{Objections and Disputes}\label{sec:objections-and-disputes}

The user raising an objection submits the following data:
\begin{itemize}
 \item the data that should be changed
 \item the reputation(s) that should vote on this issue (max. one each from organisational and skill hierarchy)
 \item proof that these reputations should be allowed to make the change in question. 
\end{itemize}

The first point is obvious - it is the subject of the objection. The second and third points concern \emph{escalation}. 

\begin{center}
 \textbf{In Colony you cannot escalate a decision to higher management, you can only escalate to bigger groups of your peers.}
\end{center}

For example, suppose that the objection concerns a task in the domain `development of our website'. The objection could chose to have all `development' reputation vote on it -- we say the decision was `escalated to the development domain'. In this example, the third point would be a proof that the domain `development of our website' was indeed a subdomain of `development'.

The highest domain any decision can be escalated to is the entire colony.

% 
% All variables in the EternalStorage contract are prefixed with what they relate to. For example, all variables to do with a task begin with \ascode{task\_}. For each type of variable, the governance system is programmed to know whether a permissions check is required. It seems likely it'll always be required, to me... can anyone come up with a variable that any group should be able to change on a whim?

%When a change is proposed, assuming that skill permission checks are required, we need to ensure that the reputation they are escalating to is a direct parent of the reputation associated with the variable being changed. This is possible to do efficiently because of metadata that is placed on the skills when they are created, which includes pointers to at least the direct parent of the skill (see the skill tree section of the reputation document). When a user creates a dispute, to specify the skill that they are escalating to they provide the lookups to be used from the skill(s) associated with the variable to be change, rather than directly specifying the skill they are escalating to. This ensures that the skill(s) they escalate to are direct parents of the skill associated with the variable.

\subsection{Costs and Rewards}\label{sec:costs-of-disputes}
\subsubsection{Cost of raising an objection}
To create an objection, a user must possess enough reputation and must also stake some number of the colony's tokens. How much reputation they need and how much they have to pay depends on the level they are escalating to; the `higher up' the decision goes, the higher the cost. To be considered a valid objection, the full requirement is for 1\% of the reputation queried and 1\% of the corresponding fraction of tokens to be staked. Thus, if an objection appeals to 13\% of total colony reputation, then the objection must be backed by 0.13\% (1\% of 13\%) of reputation and the required stake is 0.13\% of all colony tokens.\\
If the initial user does not have the required number of tokens or reputation, they can still create such a proposal by staking as little as 10\% of the reputation and tokens required.\footnote{This minimum amount required to even propose a change prevents users from spamming objections - even those that wonâ€™t ever be voted on - to large numbers of people, which would impede the smooth running of the colony.} In this case the objection will not be processed until other users add their support to it, taking it over the 1\% requirement. 

\subsubsection{Cost of defending against a raised objection}
Once an objection has received sufficient backing it becomes active and, barring any further user actions for three days, the suggested change will take place. 
However, if there are users who oppose the suggested `change', they may add their support to the `keep' side. If the keep side receives sufficient support, a dispute is raised. 

If the `change' side does not garner enough support in three days, the objection fails and is rejected.
If, three days after the `change' side had enough tokens staked and the `keep' side does not, then it is assumed that the change is acceptable and it occurs.  In either of these cases, the losing side loses their tokens and reputation staked by the mechanisms described below, with the calculations assuming that a close vote took place.

As staking occurs, metadata is saved to the blockchain along with each stake, to allow a gas-efficient method of inspecting a specific reputation transfer (required in the event of there being a dispute in the reputation state). There is a rough implementation in Python for those who wish to see how exactly it happens, but broadly speaking by keeping running totals for both sides staking as stakes are made and noting any partial matches that get made (e.g. first person stakes 100 on one side, the next person stakes 50 on the other, the first person has their stake partially unmatched), this allows for an arbitrary transfer to able to be referenced by index and not have to compute all previous transfers at that time (essentially, some of the calculation is done when the stake is made).  The number of reputation updates that need to be made (excluding the children and parent reputations) in such a situation will be equal to twice the number of stakers; some updates are `null' updates with no transfer to ensure this figure is always correct.

If neither side have enough staked after three days, all parties may claim their stakes back but no change is made to the variable in question. If both sides stake the required number of tokens and reputation within the three days, then the proposal goes to a vote.

The exact mechanisms of the vote are described elsewhere and are not repeated here. The weight of a user's vote is the sum of their reputations in the skills chosen by the user who originally proposed the vote.

A vote lasts between two days and seven days, where a vote would last two days if no reputation in the colony was being queried, and seven days in the case of the full colony being queried. At the end of this time frame, if quorum is not reached, no changes are made and all participants get their staked tokens returned. We define quorum to be more than 10\% of the reputation eligible to vote has done so.

If quorum has been reached, if the proposing side won then the variable in question is changed, assuming that the reputation that voted for this outcome is more than previous vote on the same variable (see below). If the opposing side won, then the variable is not changed. In either case, the rest of the consequences are the same.

Alongside the variable that may or may not have been changed, the fraction of total rep in the colony that voted for the winning side is noted. This is the threshold that must be exceeded in a future vote in order to change the variable. This is updated after every vote on the variable, even if the decision was to maintain the current value of the variable.

5\% of the staked tokens are set aside to pay voters when they vote; if a voter has 1\% of the reputation allowed to vote on a decision, they receive 1\% of this pot that is set aside. They receive this payout when they reveal their vote, regardless of the direction they voted in or the eventual result of the decision\footnote{\code{https://www.economicsnetwork.ac.uk/sites/default/files/Ashley/6\%20References\%20for\%20KBC.pdf}}. Any tokens assigned to users that do not vote in a poll are returned to the colony pot.

At the conclusion of the poll, losing stakers receive 0-90\% of their staked tokens and the complementary percentage of the reputation they put at risk is lost. The exact amount of tokens they receive back (and therefore reputation they lose) is based on:

The number of people that voted in a decision
The fraction of the reputation in the colony that voted
How close the vote ultimately was

At the end of a vote, if the vote was very close, then the losing side receives nearly 90\% of their stake back. If the vote is lopsided enough that the winning sideâ€™s vote weight () reaches a landslide threshold  of the total vote weight, then they receive 0\% of their staked tokens back.  varies based on the fraction of total reputation in the colony that was allowed to vote, :

\[
L = 1 - \frac{R}{3}
\]

So for a small vote with little reputation in the colony being allowed to vote, the decision has to be close to unanimous for the losing side to be punished harshly. For a vote of the whole colony, the  reduces to 67\% of the votes - i.e. the reputation of the colony overall was split 2-to-1 on the decision.

Between these extremes of a landslide loss and a very slim loss, the loss of tokens and reputation suffered by the losing side ($\Delta$) varies linearly:

\[
 \Delta = 0.9 x min \left\lbrace \frac{w-0.5}{L-0.5}, 1 \right\rbrace
\]


Any tokens lost beyond the initial 10\% are split between the colony and those who staked on the winning side, proportional to the amount they staked. Half of the reputation lost beyond the initial 10\% is given to those who staked on the winning side, and half is destroyed (the colony as a whole having reputation has no meaning, unlike the idea of the colony as a whole owning tokens).



Proposing an arbitrary transaction by the Colony contract
This is no different from a normal proposal - the proposal is to set the value of a special variable to the value of the transaction data of the proposed transaction. Such a proposal requires the entire colony to be able to vote (possibly both token holders and/or reputation holders), as the actions of the contract as a whole should be available for all to vote on. In the event the proposal is successful, the special variable is set. Another subsequent transaction - able to be made by anyone - is able to call a function that executes the transaction in the special variable, and resets it to empty if successful (to prevent it being called multiple times).

Token-weighted, reputation-weighted and hybrid voting
The majority of decisions in a colony are purely reputation weighted (even though creating a vote requires stake of both tokens and reputation), though there is no reason why a more traditional token-weighted vote shouldn't be available for some decisions, nor a hybrid vote based on both reputation and token holdings. In both of these cases, every account is allowed to vote, and in the case of a hybrid vote, all reputation is eligible to be leveraged. When a hybrid vote takes place, the total reputation and the total token holdings each represent 50\% of the voting weight.

The primary use of a token weighted vote is related to the management of the colony tokens itself; it seems reasonable that the decision and ability to create more tokens should lie with the colony token holders.
