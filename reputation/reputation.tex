\section{The Reputation System}\label{sec:reputation}
\subsection{What is Reputation?}\label{subsec:what-is-reputation}

Within Colony, reputation is a number tied to an account. Reputation quantifies the contribution that user has made to the colony in recent history. Reputation will primarily be used for two things within a colony --- weighing votes of users, and determining rewards that should be allocated to users. The more reputation a user has, the more weight their vote has when making a decision. More reputation also means they receive a larger payout when rewards are issued (see Section \ref{sec:claimrewards}). We believe that because reputation is awarded to users by either direct or indirect peer approval of their actions, the consequences of this will be that influence and rewards in a colony will be assigned in meritocratic way.

\textbf{The Colony Governance System aims to be broadly meritocratic. For this reason, the majority of day-to-day decisions in a colony are weighted by the relevant reputation.} %Thus for example. any dispute in the development team will be resolved by a vote weighted by development reputation.

Unlike tokens, reputation cannot be transferred between accounts, and it cannot be bought or sold; it represents an appraisal of the account holder's activities by their peers. Reputation must therefore be earned by direct action within the colony. This reputation that is earned will eventually be lost through inaction, bad behaviour or being deemed to be wrong; an description of how reputation is gained and lost is given in Section \ref{sec:earning-losing-rep}. 

% Reputations held in one colony have no bearing on reputations held by the same account in another colony.

% Since it is not a tradable asset, reputation must be \emph{earned}. The primary method of earning reputation is by completing tasks in a colony and earning the colony's tokens. As soon as you successfully complete your first task in a colony and claim a reward of the colony's tokens, you also earn \emph{reputation} in that colony. The amount of reputation earned will be based on a combination of the performance of the user completing the task, and the payout associated with the task itself. Aside from tasks, there are administrative and managerial duties that allow users to earn reputation as well. (Section \ref{sec:earning-rep}).

% Any reputation earned is earned in a \emph{context}. The Colony Network tracks the domain in which reputation was earned and the skills associated with the action that earned it. As an example, reputation earned for the completion of a task in the `development' domain, tagged with the `solidity-dev' skill tag will be recorded as colony reputation as well as development reputation and solidity-dev reputation. (See Sections \ref{sec:rep-by-domain} and \ref{sec:rep-by-skill} for details).

% Reputation can also be lost. Any account engaged in bad behaviour will lose reputation as punishment. Furthermore \textbf{all reputation decays with time}. %Reputation has a half life of 3 months\footnote{The exact decay rate may change before release.}. 
% In order to maintain a high reputation score, an account must continue to contribute to the colony. (Section \ref{sec:losing-rep}).\\



%

%
%
\subsubsection{Reputation by Domain}\label{sec:rep-by-domain}
The organisational hierarchy of a colony provided by domains was described in Section \ref{sec:domains}. Reputation is earned in this hierarchy, and a user has a reputation in all domains that exist --- even if that reputation is zero. When a user earns or loses reputation in a domain, the reputation in all parent domains changes by the same amount. In the case of a user losing reputation, they also lose reputation in all child domains. Quantitatively, all child domains lose the same fraction of reputation that the user lost in the domain the reputation loss is notionally in. If ever a user would lose reputation and go below zero reputation, the relevant reputation becomes zero.

An example makes this clearer. Suppose a colony has a `development' domain which contains a `backend' domain and a `frontend' domain, as in Figure \ref{fig:domainhierarchysample}. Any time a member of the colony earns reputation for work completed in the backend domain, it will increase their backend reputation, their development reputation and their reputation in the all-encompassing top-level domain of the colony. Reputation earned in the development domain will only increase the development and top-level domain reputation scores of the user.

Later, the user behaves badly in the `development' domain, and they lose 100 reputation out of the 2000 they have in that domain. They also lose 100 reputation in the parent domains, and 5\% $\left(\frac{100}{2000}\right)$ of their reputation in each of the child domains of the `development' domain (which in this example, includes all of the Frontend, Backend, Node.js and Ruby domains). 

\subsubsection{Reputation by Skill}\label{sec:rep-by-skill}

We envision domains to mostly be used as an organisational hierarchy within a colony. However, this would not necessarily capture the \emph{type} of work that a user completed to earn their reputation. If the domain were a project, with tasks corresponding to both design and development work, reputation earned by completing tasks related to these skills would not be distinguishable.  To have a more fine-grained account of the type of work that a user completes to earn their reputation, the Colony Network also maintains a skill hierarchy for all colonies to use.

This global hierarchy of skills is available for all colonies to use. When a task is created, as well as being placed in a particular domain in the colony, it is also tagged with a skill from the skill hierarchy. When the worker earns reputation for successfully completing the task, they will earn reputation in the skill the task was tagged with and all parent skills. This is in addition to the reputation earned in the relevant domains. Conversely, if they are to lose reputation because their work is found inadequate, they will lose a proportional amount reputation from all child skills of the tag, if any, as is the case with the domain reputation. There is a top-level skill analogous to the top-level domain in a colony, which all skills are descendants of.

Even though the skill hierarchy is universal, reputation earned in the skill hierarchy is unique to each colony. Earning reputation in a skill in one colony has no effect on the user's reputation in that skill in any other colonies.

\subsubsection{Reputation by Colony}\label{sec:rep-by-colony}
A user's reputation in a colony is the sum of their reputation in the top-level skill and the top-level domain. This is the reputation they will be voting with in any decisions that require input from everyone in the colony. Reputation in a colony has no effect outside the colony.

%insert example diagram here ... maybe a cartoon rep-tree
%A cartoon rep tree is going to be.... extremely similar to the cartoon domain tree we already have?


\subsection{Earning and losing reputation}\label{sec:earning-losing-rep}
There are three ways to earn reputation in a colony. The first is being involved with a successfully completed task and the second is through the dispute process. In both of these cases, the user has been a productive member of the colony and is rewarded accordingly. The third way to earn reputation is upon the creation of a colony and the associated bootstrapping process (see Section \ref{sec:bootstrapping-rep}).

Reputation losses can arise from a user being found responsible for a badly executed task, or being involved in the dispute process and the dispute being resolved against them. In addition, all reputation earned by users is exposed to a continual decay over time. 

The rest of this section outlines each of these mechanisms, with references to the more detailed descriptions given elsewhere where appropriate.

\subsubsection{Reputation change from contributing to a task}\label{sec:earning-rep-from-task}
Each task requires three roles to be assigned: the administrator, the worker and the evaluator (as described in Section \ref{sec:tasks}). If the bounty for the task is denominated in the colony's token, each of these roles are eligible to earn reputation when the task is completed as long as their work was well received.

The performance of the user who has completed the work is established when the work is submitted and then evaluated. At this point, both the evaluator and the worker grade each other\footnote{These scores should be submitted using a pre-commit and reveal scheme to ensure secrecy during the rating process and avoid retaliatory grading} out of five stars.

In the case of the evaluator, a rating of 0-2 stars counts as them rejecting the work, and a score of 3-5 stars counts as accepting the work. Beyond that, we suggest the following guidelines for ratings:
\begin{itemize}
 \item[] 0 stars: user submitted no meaningful work 
 \item[]1 star:\phantom{s} user showed little activity relevant to the task, and remains far from completion on due date.
 \item[]2 stars: user was unable to complete the task, but put in a reasonable amount of effort.
 \item[]3 stars: user completed the task following the brief but there were issues during the work.
 \item[]4 stars: user completed the task acceptably and there were no complaints.
 \item[]5 stars: user completed the task to a higher standard than requested.
\end{itemize}

The actual number of reputation points $r$ earned by the worker for the completion of the task is then a function of this rating $s$ and the token payout $t$:
\begin{equation*}\label{eq:stars-to-rep}
 r = t \times \frac{2s - 5}{3}.
\end{equation*}
 
Reputation lost or gained as a function of the star rating therefore varies linearly between $-\frac{5t}{3}$ and $\frac{5t}{3}$ for zero and five stars respectively, and a rating of four stars earns the user exactly $t$. 

Similarly, the evaluator gets an amount of reputation based on their grading by the worker, but on a scale that only varies between $-t_{\rm ev}$ and $t_{\rm ev}$ (where $t_{\rm ev}$ is the evaluator's notional token payout for the task). They only earn this reputation in the current (and all parent) domains, not in the skill reputation hierarchy as they have not actually done the task. While it is likely some knowledge is required to perform the evaluation, this is not always the case; we believe that skill reputation should exclusively demonstrate ability to perform tasks.

Upon completion of a task, the administrator also earns reputation based on their token reward. There is no explicit rating of the administrator, but as with all other payments and rewards, an objection can be raised before and payout occurs. For all participants, reputation updates occur and payouts are made available only \emph{after} the objection window (described in Section \ref{sec:tasks}) has closed and all disputes  (described in Section \ref{sec:disputes}) have been resolved at the end of the task. The reputation updates and payouts are based on the final state of the task.

\subsubsection{Reputation change as a result of Disputes}\label{sec:earning-rep-in-disputes}
If a dispute occurs, causing a vote among some portion of the colony, each side will have had to stake some number of tokens. Those who staked on the side determined to be right gain their stake back, plus some tokens that have been lost by the losing side. There will also be a reputation change as a result --- those on the losing side will lose some reputation, and some of that will be gained by the winning side. Section \ref{sec:disputes} provides a full description of the dispute mechanism and the amount of tokens and reputation each side loses and gains.

\subsubsection{Bootstrapping reputation}\label{sec:bootstrapping-rep}
Since a colony's decision making procedure rests on reputation weighted voting, we are presented with a bootstrapping problem for new colonies. When a colony is new, no-one has yet completed any work in it and so nobody will have earned any reputation. Consequently, no objections can be raised and no disputes can be resolved as no-one is able to vote. Then, once the first task is successfully completed, that user has a dictatorship over decisions in the same domains or skills until another user earns similar types of reputation.

To prevent this, when a colony is created, the creator can choose addresses to have initial reputation assigned to them to allow the colony to bootstrap itself. There will be a global limit on the reputation that can be assigned in this manner in order to prevent an extreme reputation aristocracy. Given that reputation decays over time, this initial bootstrapping of reputation will not have an impact on the long-term operation of the colony. \textbf{This is the only time that reputation can be created without associated work being done.} Users receiving the reputation are presumably the colony creator or their acquaintances, and this starting reputation should be seen as a representation of the existing trust the creator has for their colleagues. 

We note that the same is not required when a new domain is created in a colony. We do not wish to allow the creation new reputation here, as this would devalue reputation already earned elsewhere in the colony. Happily, we can proceed without any new reputation. The colony is still able to make decisions and resolve disputes, because any objections can be escalated to a parent domain where reputation does exist, if necessary. Furthermore, even this escalation is not necessarily required in the event of a disagreement, because, even if there is no reputation in the \emph{domain} to contribute to the decision, users will still be able to vote based on their reputation in relevant \emph{skills}.

\subsubsection{Reputation Decay}
All reputation decays over time. Every 600000 blocks, a user's reputation in any domain or skill decays by a factor of 2. This decay occurs every hour, rather than being a step change every three months to ensure there are minimal incentives to earn reputation at any particular time. This frequent, network-wide update is the primary reason for the existence of the reputation mining protocol, which allows this near-continuous decay to be calculated off-chain without gas limits, and then realised on-chain. 

%we need more text here FIXME
\subsection{Reputation update log}\label{subsec:reputation-update-log}

Whenever an event that causes one or more users to have their reputation updated in a colony, a corresponding entry is recorded in a log in the Colony Network Contract. Each entry in the log contains

\begin{itemize}
\item The user suffering the reputation loss or gain.
\item The amount of reputation to be lost or gained.
\item The colony the update has occurred in.
\item How many reputation entries will need to be updated (including parent, child and colony-wide total reputations).
\item How many total updates to reputations have occurred before this one in this cycle, including decays and updates to parents and children.
\end{itemize}

If the reputation update is the result of a dispute being resolved (as outlined in Section \ref{sec:earning-rep-in-disputes}), then instead of these first three properties, there is a reference to the dispute-specific record of stakes in the relevant colony. For the structure of this log, and an explanation of the way that it allows individual updates to be extracted in constant gas, see \ref{appendix:rep-transfer}.

This log exists to define an ordering of all reputation updates in a reputation update cycle that is accessible on-chain. In the event of a dispute during the reputation mining protocol (described in Section \ref{sec:reputationmining}), the Colony Network Contract can use this record to establish whether an update has been included correctly.

